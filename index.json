[{"categories":["kubernetes","terraform","helm"],"contents":"Now that the Kubernetes cluster hardware is sorted out, how about the configuration? How to build a proper, full-spec Kubernetes cluster.\nkubeadm is amazingly simple tool nowadays to build a bare Kubernetes cluster easily. For networking, I want to do dual-stack IPv4/IPv6 and I\u0026rsquo;ve decided to use Calico as CNI. The control-plane will be HA on three nodes with keepalived and haproxy configured.\nFor primary storage I will install Longhorn, a distributed block storage from Rancher that will be provided 2.5TB of capacity with up to three times replication.\nThe basic configuration is with kubeadm but everything else I want to deploy with Terraform.\nTerraform has pretty decent support for both kubernetes and helm providers and using it will provide very flexible way to experiment in the cluster, to destroy deployments easily, and to integrate everything in a single stack of infrastructure code. The code can also do other parts like VPN connectivity to Azure, AWS and GCP and configure all aspects of DNS data.\nFor the cluster nodes, there are simple Ansible playbooks to configure stock Ubuntu with the necessary packages and common settings, including keepalived and haproxy for the master nodes.\nTerraform vs. Helm Configuring basic items such as BGP peerings for Calico are pretty straightforward with Terraform but what about various workload applications?\nSometimes there is official Helm chart available, sometimes someone has implemented a good or less good Helm chart. Sometimes the application is pretty easy to deploy with simple native Kubernetes native configuration.\nIt\u0026rsquo;s a bit like Terraform modules. Sometimes one can find amazing, well executed Terraform modules but often they are lacking features, include \u0026ldquo;too much\u0026rdquo;, or just don\u0026rsquo;t do something like you\u0026rsquo;d want. Helm charts can have the same problem and one can find several charts for the same application.\nRight now I\u0026rsquo;m considering to use helm chart deployments only if they are properly done, officially supported and look good. If that\u0026rsquo;s not the case and the application deployment is simple, I can deploy it as native Terraform kubernetes resources.\n","permalink":"https://petri-ojala.github.io/blog/2021-04-05-a-foreword/","tags":null,"title":"Kubernetes configuration"},{"categories":["kubernetes"],"contents":"Most of the workloads in the house has already been running on top of Kubernetes cluster for the last couple of years. Not only has it given an opportunity to learn more about K8S but it\u0026rsquo;s an amazing flexible platform to run the usual applications.\nThe current cluster is a stack of six Raspberry Pi 4 boards with 8GB of memory and 4-core ARM CPU. The latest Raspberry generation is finally powerful enough and has enough memory to run a decent Kubernetes cluster.\nThere\u0026rsquo;s also one additional Intel Atom board with 8GB of memory and 4 cores for containers that require x86 platform such as integration with Google Anthos.\nFor the smallest possible footprint, the cluster has been built with Rancher\u0026rsquo;s amazing k3s and it is using NFS storage from the FreeNAS server. For load-balancer and network integration, MetalLB has been configured.\nThe setup is automated, a bit, and bit of a mess, too. There is Ansible playbooks to configure the nodes from stock Ubuntu, a few helm deployments, and too many classic yaml deployments for the workloads.\nThe cluster has 24 ARM cores, four x86 cores, and a total 56GB of memory.\nThe Raspberry Pi 4 cluster has been a great tool and highly recommend building one but for me, it\u0026rsquo;s time to up the game and move on..\n","permalink":"https://petri-ojala.github.io/blog/2021-05-12-a-old-kubernetes/","tags":null,"title":"Kubernetes today"},{"categories":["kubernetes"],"contents":"So the plan is to rebuild the Kubernetes cluster for home. What are the specs?\n Move to x86 nodes Dual-stack IPv4/IPv6 HA control plane Normal Kubernetes, not k3s Proper CNI for networking Properly templated configuration, preferably with Terraform  Shouldn\u0026rsquo;t be too hard, right?\nI don\u0026rsquo;t want to invest too much in the setup so I was a bit challenged by the setup. Intel NUC\u0026rsquo;s would be nice but the costs add up pretty quickly. A colleague recommended some used office PCs and they had pretty decent specs, 4 cores Intel i5 and up to 32 GB of memory.\nThings escalated pretty quickly.. First verkkokauppa.com had an outlet price for a nice Intel NUC10I5FNK that has 4/8-core Intel i5, up to 64GB of memory and pretty fast M.2 NVMe support. I was really amazed how small, quiet and powerful the machine is.\nTeraset was auctioning used Fujitsu Q556 office PC\u0026rsquo;s, they are small and quiet with 4/4-core Intel i5, up to 32GB of memory (8GB included) and have 256GB SATA SSD. There\u0026rsquo;s place for M.2 NVMe storage as well. The price wasn\u0026rsquo;t too bad and ended up buying four of them for the same price as the auction unit.\nThe NUC was equipped with 32GB memory and 1TB NVMe SSD. Each Fujitsu Q556 was expanded to 16GB of memory (used SIMMs from iotech) and ended up equipping each with 512GB of M.2 NVMe storage from Jimm\u0026rsquo;s birthday deal.\nThe cluster will have 24 vCPUs, 96GB of memory, 1.5TB of SSD storage for operating system and 2.5TB of storage for Kubernetes cluster.\n","permalink":"https://petri-ojala.github.io/blog/2012-05-12-b-new-kubernetes/","tags":null,"title":"Kubernetes tomorrow"},{"categories":["blog","github"],"contents":"Wouldn\u0026rsquo;t dance videos on Tik Tok be more like 2021 than a blog?\nMaybe, or at least I could start to call myself a social media influencer but not sure if I would find the content that useful in the long run.\nThere\u0026rsquo;s probably a billion ways to run a blog nowadays, from legacy WordPress to some python functions in AWS Lambda but I\u0026rsquo;ve decided to do something different. I don\u0026rsquo;t want to maintain anything and there was a few things I wanted to try out anyway, so..\n![Gopher)[/images/gopher.png)\nThis web site is built with Hugo, one of the most popular open-source static site generators or at least that\u0026rsquo;s what they say at https://gohugo.io/. It\u0026rsquo;s written in go so it must be..\nThe theme is Horthernlab by Themefisher, https://themes.gohugo.io/northendlab-hugo/ that is powered by Bootstrap 4 and responsive ready \u0026ndash; seems to work fine on mobile browsers, too. I might switch to some more featurerich theme at some point though, we\u0026rsquo;ll see.\nThe source for the site is hosted on a private repository on Github. Whenever the content is updated, a Github Actions workflow will be triggered that will build the website with hugo. The resulting site is then uploaded to another, public Github repository that is available as Github Pages site with custom domain. All that happens in about 10-15 seconds, isn\u0026rsquo;t that cool?\n","permalink":"https://petri-ojala.github.io/blog/2021-04-05-b-blog-platform/","tags":null,"title":"Blog platform"},{"categories":["internet","network","firewall"],"contents":"Edge router and firewall.\nCurrently on the edge I run Ubiquiti\u0026rsquo;s EdgeRouter 4. It\u0026rsquo;s a small device with three ethernet ports and one SFP port running embedded Linux and Vyatta for routing features. It can hardware offload a lot of packet pushing so it\u0026rsquo;s pretty capable device \u0026ndash; up to 4 Gbit/s and 320kpps for large packets, and up to 1.8 Gbit/s and 3400kpps for small packets.\nBut it hasn\u0026rsquo;t received that much love from Ubiquiti recently, software updates have been occasional not that I\u0026rsquo;ve missed much features anyway.\nIs it time to upgrade? Maybe, or maybe not, I\u0026rsquo;d like to switch to OPNsense but I don\u0026rsquo;t feel like it\u0026rsquo;s absolutely necessary.\nOPNsense would have quite a lot of new features, it\u0026rsquo;s more like a firewall with a router and OPNsense just recently announced some new devices that are ready for the job. DEC690 is based on AMD\u0026rsquo;s emdedded Ryzen and can do up to 3.3 Gbit/s firewall, 600 Mbit/s VPN and is fanless like the EdgeRouter.\nI could enjoy having some visibility to who\u0026rsquo;s knocking on the door, have a HAProxy for inbound connectivity, and get some flow statistics about the traffic.\nI also have another EdgeRouter X that is used for AWS, Azure and Google Cloud VPN\u0026rsquo;s. It\u0026rsquo;s a separate device and can be used the same way as with DNA, both DNA and Elisa provide up to five public IPs. The VPN\u0026rsquo;s are IPSec but perhaps the hyperscalers will include WireGuard support at some point.\nI do have a bigger wish though; I would like to manage the router with Terraform or Ansible. There isn\u0026rsquo;t much for EdgeOS and Terraform, the OPNsense provider for Terraform seems to be a bit limited but it\u0026rsquo;s probably something that I could work on..\n","permalink":"https://petri-ojala.github.io/blog/2021-05-06-a-router-firewall/","tags":null,"title":"Reflections - Edge firewall"},{"categories":["internet","network"],"contents":"Internet connectivity \u0026ndash; 1 Gbit/s have must one.\nOur current apartment doesn\u0026rsquo;t have fiber to the premises so the only options are various FTTC options that use VDSL2 or HFC cable TV internet which I use:\n DNA\u0026rsquo;s 1000M service Actual throughput around 900 Mbit/s, 50-100 Mbit/s upstream DOCSIS 3.0 Sagecom F-3686AC cable modem Up to five public IPv4 addresses, /56 IPv6 prefix  The service has been pretty good, consistent performance, no outages except every couple of years the modem configuration is updated by the carrier and reset to non-working state as I don\u0026rsquo;t use any of it\u0026rsquo;s features, it\u0026rsquo;s just bridging.\nFTTH\nThe new apartment will have fiber to the home.\n Ethernet-based connection 1000/100 service available Up to five public IPv4 addresses, no IPv6  Lack of IPv6 is bit of a bummer with so many years with dual-stack environment and a majority of the traffic being IPv6 by now. It\u0026rsquo;s time to contact old colleagues at Elisa to see if there might a beta program available (there must be, right?) or perhaps try out kuusitunneli.fi, a free IPv6 tunnel service.\n","permalink":"https://petri-ojala.github.io/blog/2021-05-05-b-internet/","tags":null,"title":"Reflections - Internet"},{"categories":["network","wifi"],"contents":"Upgrading WiFi is a bit more complex topic. THere is new technology available but it\u0026rsquo;s not only about what to do with the access point(s) but also about the clients. Replacing clients usually doesn\u0026rsquo;t make much sense and right now we have only two WiFi 6 (802.11ax) devices \u0026ndash; OnePlus 8 Pro and Macbook Pro M1.\nThe benchmark for WiFi has been the ability to use the full Gigabit Internet access over WiFi and right now it works with the current WiFi access point, TP-Link Archer C5400:\n One 2.4 Ghz radio (802.11n, up to 1000 Mbps) Two 5 GHz radios (802.11ac, up to 2167 Mbps each) 4x4 MU-MIMO, 12 Streams, DFS Up to HT80 on 5 GHz, up to HT40 on 4 GHz  It works up to a Gigabit with iMac 5K as the WiFi client. It was a bit pain to configure as dumb as possible, just to bridge between wireless and wired, but it has done the job pretty well and has been completely trouble free.\nA year ago I tested Netgreat\u0026rsquo;s RAX80, a 8-stream WiFi 6 model but despite the better specs it didn\u0026rsquo;t do any better than the C5400, even with 802.11ax to the phone.\nSo what should be the plan?\nFirst problem is that it\u0026rsquo;s unclear what kind of coverage is required for the new apartment. Perhaps well positioned one access point can do the job well enough. I\u0026rsquo;m not that keen to install multiple access points with a controller so prefer single access points that can be installed, configured and forgotten about.\nThe technical requirements should be something like:\n One 2.4 GHz radio (performance not that relevant, for legacy devices) One 5 GHz radio, high performance, up to HT160, WiFi 6 (802.11ax) One 6 GHz radio, high performance, up to HT160, WiFi 6E  If staying in the TP-Link family, their Archer AX96 looks interesting.\nWhy WiFi 6E? I don\u0026rsquo;t see huge benefits from WiFi 6 but 6E is on a higher frequency, it most likely has similar coverage inside the apartment but 6E has much more bandwidth available. 5 GHz can fit only two HT160 channels while 6 GHz can fit seven of them.\nIn any case I think it\u0026rsquo;s a safe bet to continue with the existing access point and after becoming familiar with the apartment\u0026rsquo;s wireless characteristics, take a look at the market and see if there\u0026rsquo;s an interesting product(s) available.\n","permalink":"https://petri-ojala.github.io/blog/2021-05-06-c-wifi/","tags":null,"title":"Reflections - WiFi"},{"categories":["wired","network"],"contents":"Networking \u0026ndash; let\u0026rsquo;s think about the boring cables first.\nPeople tend to focus on wireless access but what one really should be doing is to make sure that if there are wires around everything should be connected with wires, if possible.\nIn our current apartment we have ethernet wall plates here and there and it\u0026rsquo;s been relatively easy to wire the place but as this has been built around 15 years ago the cabling is probably Cat5 or Cat5e as it cannot handle anything above 1 Gbit/s that well.\nI think it\u0026rsquo;s time to set the bar higher \u0026ndash; if possible, have at least 2.5 Gbit/s around the new apartment.\nThere all ethernet wall plates around the new apartment but the details are still unclear. As it\u0026rsquo;s a few years old construction, the cables could well handle 2.5 or even 5 Gbit/s.\nIf 10 Gbit/s over copper works, that will be amazing and I will not be able to stay away from it.. Some links will anyway be with 10GE SFP+ direct attach.\nSwitches The current dumb gigabit-switches and a few Mikrotik\u0026rsquo;s should be a good starting point. The Mikrotik\u0026rsquo;s have some SFP+ ports for faster connections and I have a few DA\u0026rsquo;s around.\nThere are some inexpensive 2.5GE switches arriving to the market, for example 5- and 8-port devices from TRENDnet. These should be fine to use so I might update some core switching devices if the price is right.\nVLANs This is a tricky part.. I don\u0026rsquo;t run separate VLANs for different devices or device classes right now. It didn\u0026rsquo;t feel like worth the effort. However the current IPv4 ranges are split to fictitious /24 blocks based on the devices so switching to separate VLANs should be relatively easy. IPv6 is dynamic though.\nI don\u0026rsquo;t want to go too complex with the VLANs but perhaps it\u0026rsquo;s time to have a few. Thanks to all the auto-discovery and IoT devices, one more than likely needs to configure mDNS repeater between the VLANs.\n","permalink":"https://petri-ojala.github.io/blog/2021-05-05-a-network/","tags":null,"title":"Reflections - Wired networking"},{"categories":null,"contents":"","permalink":"https://petri-ojala.github.io/blog/2012-05-12-c-kubernetes-config/","tags":null,"title":""},{"categories":null,"contents":"x\u0026mdash; title: \u0026ldquo;Tools\u0026rdquo; draft: false description : \u0026ldquo;this is meta description\u0026rdquo; layout: tools ","permalink":"https://petri-ojala.github.io/blog/tools/","tags":null,"title":""},{"categories":null,"contents":"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labor.\n","permalink":"https://petri-ojala.github.io/blog/contact/","tags":null,"title":"Contact Us"},{"categories":null,"contents":"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n","permalink":"https://petri-ojala.github.io/blog/author/john-doe/","tags":null,"title":"John Doe"},{"categories":null,"contents":"Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.\n","permalink":"https://petri-ojala.github.io/blog/author/mark-dinn/","tags":null,"title":"Mark Dinn"}]