<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Kubernetes configuration</title><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="Kubernetes"><meta name=author content="Themefisher"><meta name=generator content="Hugo 0.64.0"><link rel=stylesheet href=https://petri-ojala.github.io/blog/plugins/bootstrap/bootstrap.min.css><link rel=stylesheet href=https://petri-ojala.github.io/blog/plugins/themify-icons/themify-icons.css><link rel=stylesheet href=https://petri-ojala.github.io/blog/scss/style.min.css media=screen><link rel="shortcut icon" href=https://petri-ojala.github.io/blog/images/favicon.png type=image/x-icon><link rel=icon href=https://petri-ojala.github.io/blog/images/favicon.png type=image/x-icon></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=" height=0 width=0 style=display:none;visibility:hidden></iframe></noscript><div class=preloader></div><header class="fixed-top navigation"><div class=container><nav class="navbar navbar-expand-lg navbar-light bg-transparent"><a class=navbar-brand href=https://petri-ojala.github.io/blog/><img class=img-fluid src=/blog/images/logo.svg alt=Pilvilinna></a>
<button class="navbar-toggler border-0" type=button data-toggle=collapse data-target=#navigation>
<i class="ti-menu h3"></i></button><div class="collapse navbar-collapse text-center" id=navigation><ul class="navbar-nav ml-auto"><li class=nav-item><a class=nav-link href=https://petri-ojala.github.io/blog/>Home</a></li><li class=nav-item><a class=nav-link href=https://petri-ojala.github.io/blog/contact>Contact</a></li></ul><div class=search><button id=searchOpen class=search-btn><i class=ti-search></i></button><div class=search-wrapper><form action=https://petri-ojala.github.io/blog/search class=h-100><input class="search-box px-4" id=search-query name=s type=search placeholder="Type & Hit Enter..."></form><button id=searchClose class=search-close><i class="ti-close text-dark"></i></button></div></div></div></nav></div></header><div class="py-5 d-none d-lg-block"></div><section class=section><div class=container><div class=row><div class="col-lg-8 mx-auto block shadow mb-5"><h2>Kubernetes configuration</h2><div class="mb-3 post-meta"><a href=/blog/author/petri-ojala>Petri Ojala</a>,
May 12, 2021,
<a href=/blog/categories/kubernetes>Kubernetes</a>
<a href=/blog/categories/terraform>Terraform</a>
<a href=/blog/categories/helm>Helm</a></div><img src=/blog/images/k8s-config.jpg class="img-fluid w-100 mb-4" alt="Kubernetes configuration"><div class="content mb-5"><p>Now that the Kubernetes cluster hardware is sorted out, how about the configuration? How to
build a proper, full-spec Kubernetes cluster.</p><p><code>kubeadm</code> is amazingly simple tool nowadays to build a bare Kubernetes cluster easily. For
networking, I want to do dual-stack IPv4/IPv6 and I&rsquo;ve decided to use Calico as CNI.
The control-plane will be HA on three nodes with keepalived and haproxy configured.</p><p>For primary storage I will install Longhorn, a distributed block storage from Rancher that
will be provided 2.5TB of capacity with up to three times replication.</p><p>The basic configuration is with <code>kubeadm</code> but everything else I want to deploy with Terraform.</p><p>Terraform has pretty decent support for both <code>kubernetes</code> and <code>helm</code> providers and using
it will provide very flexible way to experiment in the cluster, to destroy deployments
easily, and to integrate everything in a single stack of infrastructure code. The code
can also do other parts like VPN connectivity to Azure, AWS and GCP and configure
all aspects of DNS data.</p><p>For the cluster nodes, there are simple Ansible playbooks to configure stock Ubuntu
with the necessary packages and common settings, including keepalived and haproxy
for the master nodes.</p><h3 id=terraform-vs-helm>Terraform vs. Helm</h3><p>Configuring basic items such as BGP peerings for Calico are pretty straightforward
with Terraform but what about various workload applications?</p><p>Sometimes there is official Helm chart available, sometimes someone has implemented a good
or less good Helm chart. Sometimes the application is pretty easy to deploy with
simple native Kubernetes native configuration.</p><p>It&rsquo;s a bit like Terraform modules. Sometimes one can find amazing, well executed
Terraform modules but often they are lacking features, include &ldquo;too much&rdquo;, or
just don&rsquo;t do something like you&rsquo;d want. Helm charts can have the same problem and
one can find several charts for the same application.</p><p>Right now I&rsquo;m considering to use helm chart deployments only if they are properly
done, officially supported and look good. If that&rsquo;s not the case and the
application deployment is simple, I can deploy it as native Terraform
kubernetes resources.</p></div><div class="mb-3 post-meta"></div></div><div class="col-lg-8 mx-auto block shadow"></div></div></div></section><footer class="py-4 bg-light border-top"><div class=container><div class="row justify-content-between align-items-center"><div class="col-lg-4 text-center text-lg-left mb-4 mb-lg-0"><a href=https://petri-ojala.github.io/blog/ class="d-block pb-3"><img src=/blog/images/logo.svg class=img-fluid alt=Pilvilinna></a></div><div class="col-lg-4 text-center mb-4 mb-lg-0"><ul class="list-inline mb-0"><li class=list-inline-item><a class="text-dark d-block p-2" href=https://petri-ojala.github.io/blog/contact>Contact</a></li></ul></div><div class="col-lg-4 text-lg-right text-center mb-4 mb-lg-0"><ul class="list-inline social-icon mb-0"><li class=list-inline-item><a href=#><i class=ti-github></i></a></li><li class=list-inline-item><a href=#><i class=ti-linkedin></i></a></li></ul></div></div><div class="text-center mt-4"><span>Â© 2020 <a href=https://gethugothemes.com>Gethugothemes</a> All Rights Reserved</span></div></div></footer><script>var indexURL="https://petri-ojala.github.io/blog/index.json"</script><script src=https://petri-ojala.github.io/blog/plugins/jQuery/jquery.min.js></script><script src=https://petri-ojala.github.io/blog/plugins/bootstrap/bootstrap.min.js></script><script src=https://petri-ojala.github.io/blog/plugins/search/fuse.min.js></script><script src=https://petri-ojala.github.io/blog/plugins/search/mark.js></script><script src=https://petri-ojala.github.io/blog/plugins/search/search.js></script><script src=https://petri-ojala.github.io/blog/js/script.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/js-cookie/2.2.1/js.cookie.min.js></script><div id=js-cookie-box class="cookie-box cookie-box-hide">This site uses cookies. By continuing to use this website, you agree to their use. <span id=js-cookie-button class="btn btn-sm btn-outline-primary ml-2">I Accept</span></div><script>(function($){const cookieBox=document.getElementById('js-cookie-box');const cookieButton=document.getElementById('js-cookie-button');if(!Cookies.get('cookie-box')){cookieBox.classList.remove('cookie-box-hide');cookieButton.onclick=function(){Cookies.set('cookie-box',true,{expires:2});cookieBox.classList.add('cookie-box-hide');};}})(jQuery);</script><style>.cookie-box{position:fixed;left:0;right:0;bottom:0;text-align:center;z-index:9999;padding:1rem 2rem;background:#474747;transition:all .75s cubic-bezier(.19,1,.22,1);color:#fdfdfd}.cookie-box-hide{display:none}</style></body></html>